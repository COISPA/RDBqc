---
title: "Quality checks on RDBFIS data formats"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{RDBqc}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(RDBqc)
```

RDBqc allows to carry out a set of _a priori_ quality checks on detailed sampling data and on aggregated landing data, and _a posteriori_ quality checks on MEDBS, FDI and GFCM data call formats.

The supported quality checks in version `r packageVersion("RDBqc")` are:

### _A priori_ quality checks
* RCG CS - biological sampling data
* RCG CL - aggregated landing data

### _A posteriori_ quality checks
* MEDBS - catch data
* MEDBS - discard data
* MEDBS - landing data
* MEDBS - GP table
* MEDBS - LW table
* MEDBS - MA table
* MEDBS - ML table
* MEDBS - SA table
* MEDBS - SL table
* FDI tables (G, H, I and J)
* GFCM - Task II.2 table
* GFCM - Task III table
* GFCM - Task VII.2 table
* GFCM - Task VII.3.1 table
* GFCM - Task VII.3.2 table

# Checks on RCG

Example of Regional Coordination Group Mediterranean & Black Sea data formats:

**CS table**

```{r input1}
head(data_ex)
```

**CL table**

```{r input2}
head(data_exampleCL)
```

## Checks on CS

### check LFD

This function `RCG_check_LFD` returns an empty data frame if all the lengths collected are within the length range min_len-max_len; if some lengths are outside this range, the corresponding records are returned as a data frame.

```{r RCG_check_LFD}
RCG_check_LFD(data_ex,MS="ITA",GSA="GSA99", SP="Mullus barbatus",min_len=6,max_len=250)[[1]]
```

A plot of the frequency distribution is also returned:

```{r RCG_check_LFD2,fig.height=6,fig.width=9}
RCG_check_LFD(data_ex,MS="ITA",GSA="GSA99", SP="Mullus barbatus",min_len=6,max_len=250)[[2]]
```

### check LFD by commercial categories

This function `RCG_check_LFD_comm_cat` reports for each year and commercial category the minimum and maximum lengths in the dataset.

```{r RCG_check_LFD_comm_cat}
RCG_check_LFD_comm_cat(data_ex,MS="ITA",GSA="GSA99", SP="Mullus barbatus")[[1]]
```

A plot of the length distributions by year and commercial category is also returned:

```{r RCG_check_LFD_comm_cat2,fig.height=6,fig.width=9}
RCG_check_LFD_comm_cat(data_ex,MS="ITA",GSA="GSA99", SP="Mullus barbatus")[[2]]
```

### Check AL 

This function `RCG_check_AL` reports for each year and length class the number of age measurements in the dataset, providing a summary data frame. 

```{r RCG_check_AL}
results <- RCG_check_AL(data_ex,MS="ITA",GSA="GSA99",SP="Mullus barbatus",min_age=0,max_age=5)[[1]]
head(results)
```

Moreover, the function detects if the age data are in the range min_age-max_age, reporting the list of the trip codes including outliers. 

```{r RCG_check_AL2}
RCG_check_AL(data_ex,MS="ITA",GSA="GSA99",SP="Mullus barbatus",min_age=0,max_age=5)[[2]]
```

A plot of the age/length relationship by sex and year is outputted for the selected species

```{r RCG_check_AL3,fig.height=6,fig.width=9}
RCG_check_AL(data_ex,MS="ITA",GSA="GSA99",SP="Mullus barbatus",min_age=0,max_age=5)[[3]]
```

### Check lw 

This function `RCG_check_lw` plots for each year and sex the length-weight scatter plot

```{r RCG_check_lw2,fig.height=6,fig.width=9}
RCG_check_lw(data_ex,MS="ITA",GSA="GSA99", SP="Mullus barbatus",Min=0,Max=200)[[2]]
```

Furthermore, it checks if the weight data are within the boundaries in input, providing the data frame of the records with the outliers

```{r RCG_check_lw1}
RCG_check_lw(data_ex,MS="ITA",GSA="GSA99", SP="Mullus barbatus",Min=0,Max=200)[[1]]
```

### check maturity stages 

This function `RCG_check_mat` plots for each year and sex the length-maturity stage scatter plot

```{r RCG_check_mat, results='hide', message=FALSE, warning=FALSE,fig.height=6,fig.width=9}
RCG_check_mat(data_ex,MS="ITA",GSA="GSA99",SP="Mullus barbatus")
```

### check matutity ogive

This function `RCG_check_mat_ogive` plots the maturity ogive by sex derived from the dataset:

```{r RCG_check_mat_ogive,fig.height=6,fig.width=9}
RCG_check_mat_ogive(data_ex,MS="ITA",GSA="GSA99",SP="Mullus barbatus", sex="F",immature_stages=c("0","1","2a"))
```
 
### Summarize individual measurements

This function `RCG_summarize_ind_meas` reports for each trip the number of length sex, maturity, individual weight and age measurements for a selected species. 

```{r RCG_summarize_ind_meas}
results <- RCG_summarize_ind_meas(data=data_ex,MS="ITA",GSA="GSA99",SP="Mullus barbatus")
head(results)
```

### Summarize trips

This function `RCG_summarize_trips` reports for the selected species the number of trips in the dataset for each year, area, harbour, metier and sampling method. 

```{r RCG_summarize_trips}
results <- RCG_summarize_trips(data_ex,MS="ITA",GSA="GSA99",SP="Mullus barbatus")
head(results)
```

### Check trips location

The function `RCG_check_loc` allows to check the spatial distribution of data using the initial and final coordinates, where available, and the ports position included in the data.

```{r RCG_check_loc,fig.height=8,fig.width=10}
RCG_check_loc(data_ex)
```

## Checks on CL

This function `RCG_check_CL` allows to check the data in the CL table for the selected species. The output is a list of 6 data frames:

1. Sum of Landings by year, quarter and month;

```{r RCG_check_CL1}
RCG_check_CL(data_exampleCL,MS="COUNTRY1",GSA="GSA99",SP="Parapenaeus longirostris")[[1]]
```

2. Sum of Landing value by year, quarter and month;

```{r RCG_check_CL2}
RCG_check_CL(data_exampleCL,MS="COUNTRY1",GSA="GSA99",SP="Parapenaeus longirostris")[[2]]
```

3. Sum of landings by LandCtry, VslFlgCtry,  Area, Rect, SubRect, Harbour;

```{r RCG_check_CL3}
RCG_check_CL(data_exampleCL,MS="COUNTRY1",GSA="GSA99",SP="Parapenaeus longirostris")[[3]]
```

4. Sum of landing value by LandCtry, VslFlgCtry,  Area, Rect, SubRect, Harbour;

```{r RCG_check_CL4}
RCG_check_CL(data_exampleCL,MS="COUNTRY1",GSA="GSA99",SP="Parapenaeus longirostris")[[4]]
```

5. Sum of landings by Year, Species, foCatEu5, foCatEu6;

```{r RCG_check_CL5}
RCG_check_CL(data_exampleCL,MS="COUNTRY1",GSA="GSA99",SP="Parapenaeus longirostris")[[5]]
```

6. Sum of landing value by Year, Species, foCatEu5, foCatEu6.

```{r RCG_check_CL6}
RCG_check_CL(data_exampleCL,MS="COUNTRY1",GSA="GSA99",SP="Parapenaeus longirostris")[[6]]
```

7. Plot of the landings by year and foCatEu6

```{r RCG_check_CL7,fig.height=6,fig.width=9}
RCG_check_CL(data_exampleCL,MS="COUNTRY1",GSA="GSA99",SP="Parapenaeus longirostris")[[7]]
```

# Checks on MEDBS tables

_catch table_

```{r Catch_tab_example}
head(Catch_tab_example)
```

_landings table_

```{r Landing_tab_example}
head(Landing_tab_example)
```

_discards table_

```{r Discard_tab_example}
head(Discard_tab_example)
```

## Checks on Catch table

### check duplicated records

The function `MEDBS_check_duplicates` checks the presence of duplicated rows in catch table 

```{r MEDBS_check_duplicates_catches}
catch_with_diplicate <- rbind(Catch_tab_example,Catch_tab_example[1,])
MEDBS_check_duplicates(data=catch_with_diplicate,type="c",MS="ITA",GSA="GSA 9",SP="DPS",verbose=TRUE)
```


### Check catches coverage

The function `MEDBS_Catch_coverage` allows to check the coverage in Catch table by mean of summary tables summarizing both landing and discard volumes and producing relative plots for the selected species. In particular:

1. summary table of landings

```{r MEDBS_Catch_coverage1}
results <- suppressMessages(MEDBS_Catch_coverage(Catch_tab_example,"DPS","ITA","GSA 9"))
head(results[[1]])
```

2. summary table of discards

```{r MEDBS_Catch_coverage2}
head(results[[2]])
```

3. Plot of landing volumes in catch table

```{r MEDBS_Catch_coverage3,fig.height=6,fig.width=9}
results[[3]]
```

4. Plot of discard volumes in catch table

```{r MEDBS_Catch_coverage4,fig.height=6,fig.width=9}
results[[4]]
```

### check Sum of products (SOP)

The function checks if the percentage difference between SOP and both volumes of landing and discard are greater then a threshold value. The default value is fixed to 5%.

threshold = 5

```{r}
MEDBS_SOP(data=Catch_tab_example,SP="DPS",MS="ITA",GSA="GSA 9",threshold = 5)
```

threshold = 2

```{r}
MEDBS_SOP(data=Catch_tab_example,SP="DPS",MS="ITA",GSA="GSA 9",threshold = 2)
```

## Checks on discard and landing tables

### check duplicated records

The function `MEDBS_check_duplicates` checks the presence of duplicated rows in landings 

```{r MEDBS_check_duplicates_landings}
Landing_tab_example <- rbind(Landing_tab_example,Landing_tab_example[1,])
MEDBS_check_duplicates(data=Landing_tab_example,type="l",MS="ITA",GSA="GSA 9",SP="DPS",verbose=TRUE)
```

The function `MEDBS_check_duplicates` also checks the presence of duplicated rows in discard 

```{r MEDBS_check_duplicates_discards}
Discard_tab_example <- rbind(Discard_tab_example,Discard_tab_example[1,])
MEDBS_check_duplicates(data=Discard_tab_example,type="d",MS="ITA",GSA="GSA 9",SP="DPS",verbose=TRUE)
```

## Kolmogorov-Smirnov test

The function `MEDBS_ks` allows to perform the Kolmogorov-Smirnov test on both landings and discards for a selected species. The function performs Kolmogorov-Smirnov tests on couples of years to assess if they belong to the same population, returning a summary data frame. The function returns also the cumulative length distribution plots by fishery and year.

```{r MEDBS_ks_landing1,fig.height=10,fig.width=10}
ks <- MEDBS_ks(data=Landing_tab_example, type="l", SP="DPS",MS="ITA",GSA="GSA 9",Rt=1)
results <- ks[[1]]
head(results)
```


```{r MEDBS_ks_landing2,fig.height=10,fig.width=10}
# plot(ks[[3]])
```

### Check consistency of length data

The function `MEDBS_length_ind` allows to check the consistency of length data for a selected species on both landings and discards returning a summary table of the main length size indicators time series by fishery.

```{r MEDBS_length_ind_tab}
results <- MEDBS_length_ind(Discard_tab_example,type="d",SP="DPS",MS=c("ITA"),GSA=c("GSA 9"), splines=c(0.2,0.4,0.6,0.8),Xtresholds = c(0.25,0.5,0.75))
head(results[[1]])
```

A plot of the time series of mean length in discards and landings is returned.

```{r MEDBS_length_ind_plot1,fig.height=6,fig.width=9}
results[[2]]
```

A plot of the time series of median length in discards and landings is returned.

```{r MEDBS_length_ind_plot2,fig.height=6,fig.width=9}
results[[3]]
```

### Check of null individuals in landings and discards

The function `MEDBS_lengthclass_0` checks landings and discards for the presence of length class filled in having weigth > 0, returning a data frame with the rows with 0 values length class having weigth > 0.

```{r MEDBS_lengthclass_0}
results <- MEDBS_lengthclass_0(data=Landing_tab_example,type="l",SP="DPS",MS="ITA",GSA="GSA 9",verbose=TRUE)
head(results)
```

### weight 0 in landings and discards

The function `MEDBS_weight_0` checks landings or discards in weight equal to 0 having length classes filled in, returning the number of rows with 0 values in weights having length classes filled in.

```{r MEDBS_weight_0}
MEDBS_weight_0(data=Discard_tab_example,type="d",SP="DPS",MS="ITA",GSA="GSA 9", verbose=TRUE)
```

### weight -1 in landings and discards

The function `MEDBS_weight_minus1` checks landings in weight equal to -1 having length class filled in, returning the number of rows with -1 values in landing weights having length class filled in.

```{r MEDBS_weight_minus1}
MEDBS_weight_minus1(data=Discard_tab_example,type="d",SP="DPS",MS="ITA",GSA="GSA 9",verbose=TRUE)
```

### Years with missing length distributions

The function `MEDBS_yr_missing_length` checks the presence of years with missing length distributions in both landings and discards for a selected species. A data frame of the missing length distributions is returned.

```{r MEDBS_yr_missing_length}
results <- MEDBS_yr_missing_length(data=Landing_tab_example,type="l",SP="DPS",MS="ITA",GSA="GSA 9")
head(results)
```

## Checks on landings

### Comparison between landings in weight by quarter accounting for vessel length

The function `MEDBS_comp_land_Q_VL` allows to perform the comparison of landings of a selected species aggregated by quarters accounting for the presence of vessel length. A dataframe for the comparison of landings aggregated by quarters accounting for the presence of vessel length information is returned.

```{r MEDBS_comp_land_Q_VL}
results <- suppressMessages(MEDBS_comp_land_Q_VL(data = Landing_tab_example, 
           SP = "DPS", MS = "ITA", GSA = "GSA 9"))
head(results)
```

### Comparison between landings in weight by quarter and fishery accounting for vessel length

The function `MEDBS_comp_land_Q_VL_fishery` allows to perform the comparison of landings of a selected species aggregated by quarters and fishery accounting for the presence of vessel length. 
The function returns a data frame for the comparison of landings aggregated by quarters and fishery accounting for the presence of vessel length information.

```{r MEDBS_comp_land_Q_VL_fishery}
results <- suppressMessages(MEDBS_comp_land_Q_VL_fishery(data = Landing_tab_example, 
        MS = "ITA", GSA = "GSA 9", SP = "DPS"))
head(results)
```

### Comparison between landings in weight by quarter and -1

The function `MEDBS_comp_land_YQ` allows to perform the comparison of landings of a selected species aggregated by quarters and by year.
The function returns a data frame  for the comparison of landings aggregated by quarters and by year.

```{r MEDBS_comp_land_YQ}
MEDBS_comp_land_YQ(data=Landing_tab_example,SP="DPS",MS="ITA",GSA="GSA 9")
```

### Comparison between landings in weight by quarter, quarter -1 and by fishery

The function `MEDBS_comp_land_YQ_fishery` allows to perform the comparison of landings of a selected species aggregated by quarters and by year and fishery.
The function returns a data frame  for the comparison of landings aggregated by quarters and by year and fishery.

```{r MEDBS_comp_land_YQ_fishery}
results <- suppressMessages(MEDBS_comp_land_YQ_fishery(data = Landing_tab_example, SP = "DPS", MS = "ITA", GSA = "GSA 9"))
head(results)
```

### Check mean weight by year,gear and fishery aggregation

The function `MEDBS_land_mean_weight` allows to check consistency of  mean landing of a selected species plotting the landings' weight by year, gear and fishery.
A summary data frame is returned.

```{r MEDBS_land_mean_weight}
results <- MEDBS_land_mean_weight(data=Landing_tab_example,SP="DPS",MS="ITA",GSA="GSA 9")[[1]]
head(results)
```

The function returns a plot of the mean landing weight by year, gear and fishery aggregation as well.

```{r MEDBS_land_mean_weight2,fig.height=6,fig.width=9}
MEDBS_land_mean_weight(data=Landing_tab_example,SP="DPS",MS="ITA",GSA="GSA 9")[[2]]
```

### Plot of total landing by gear and fishery

The function `MEDBS_plot_land_vol` allows to visual check the time series of landing volumes by fishery of a selected species. The function returns a plot of the total landing time series by fishery and gear.

```{r MEDBS_plot_land_vol,fig.height=6,fig.width=9}
MEDBS_plot_land_vol(data=Landing_tab_example,SP="DPS",MS="ITA",GSA="GSA 9")
```

### Plot of total landing

The function `MEDBS_plot_landing_ts` estimates the total landings time series by both year and quarters for a selected combination of member state, GSA and species. The function returns a plot of the total landing time series by year or by quarters. The plot by year also reports the landing by gear.

```{r MEDBS_plot_landing_ts,fig.height=6,fig.width=9}
suppressMessages(MEDBS_plot_landing_ts(data=Landing_tab_example,SP="DPS",MS="ITA",GSA="GSA 9",by="quarter"))
```

### check the coverage in Landing table

The function `MEDBS_Landing_coverage` allows to check the coverage in landing table providing a summary table

```{r MEDBS_Landing_coverage}
results <- suppressMessages(MEDBS_Landing_coverage(Landing_tab_example,"DPS","ITA","GSA 9"))
head(results[[1]])
```

a plot of the landing coverage is also provided.

```{r MEDBS_Landing_coverage2,fig.height=6,fig.width=9}
results[[2]]
```

## Checks on discards

### check the coverage in discard table

The function `MEDBS_discard_coverage` allows to check the coverage of the time series in discard table for a selected species. The function returns a summary table.

```{r MEDBS_discard_coverage1}
results <- suppressMessages(MEDBS_discard_coverage(Discard_tab_example,"DPS","ITA","GSA 9"))
head(results[[1]])
```

A plots of discard time series by year and gear is also provided.

```{r MEDBS_discard_coverage2,fig.height=6,fig.width=9}
results[[2]]
```

### Comparison between discards in weight by quarter and -1

The function `MEDBS_comp_disc_YQ` allows to compare the discards weights aggregated by quarter and by year for a selected species at the gear level. The function returns a data frame  for the comparison of discards aggregated by quarters and by year

```{r MEDBS_comp_disc_YQ}
MEDBS_comp_disc_YQ(data=Discard_tab_example,SP="DPS",MS="ITA",GSA="GSA 9")
```

### Comparison between discards in weight by quarter, quarter -1 and by fishery

The function `MEDBS_comp_disc_YQ_fishery` allow to estimates the discards in weight for a selected species by quarter and fishery. The function returns a data frame  for the comparison of discards aggregated by quarters and by year and fishery

```{r MEDBS_comp_disc_YQ_fishery}
results <- MEDBS_comp_disc_YQ_fishery(data=Discard_tab_example,MS="ITA",GSA="GSA 9",SP="DPS")
head(results)
```

### Check mean weight by year,gear and fishery aggregation in discard

The function `MEDBS_disc_mean_weight` allows to check consistency of mean discard weight of a selected species providing a table of the mean individual weight by year, gear and fishery. 

```{r MEDBS_disc_mean_weight1}
results <- MEDBS_disc_mean_weight(data=Discard_tab_example,SP="DPS",MS="ITA",GSA="GSA 9")
head(results[[1]])
```

The function also returns a plot of the mean discards weight by year, gear and fishery aggregation.

```{r MEDBS_disc_mean_weight2,fig.height=8,fig.width=10}
results[[2]]
```

### Plot of total discards by gear and fishery

The function `MEDBS_plot_disc_vol` allows to visual check the time series of discard volumes by fishery of a selected species. The function returns a plot of the total discards time series by fishery and gear.

```{r MEDBS_plot_disc_vol,fig.height=6,fig.width=8}
MEDBS_plot_disc_vol(data=Discard_tab_example,SP="DPS",MS="ITA",GSA="GSA 9")
```

### Plot of total discards time series

The function `MEDBS_plot_discard_ts` estimates the total discard time series by both year and quarters for a selected combination of member state, GSA and species. The function returns a plot of the total discard time series by year or by quarters. The parameter `by="year"` also reports the landing by gear.

```{r MEDBS_plot_discard_ts,fig.height=6,fig.width=9}
MEDBS_plot_discard_ts(data=Discard_tab_example,SP="DPS",MS="ITA",GSA="GSA 9",by="quarter")
```

## Other checks

### GP_tab (growth params) table check

The function `MEDBS_GP_check` allows to check the growth parameters by sex and year for a selected species.  The function returns a list of objects containing a summary table and different plots of the growth curves by sex

```{r GP_check1}
results <- MEDBS_GP_check(GP_tab_example,"MUT","ITA","18")
results[[1]]
print(names(results)[1])
```

```{r GP_check2,fig.height=6,fig.width=9}
print(names(results)[2])
results[[2]]
```

```{r GP_check3,fig.height=6,fig.width=9}
print(names(results)[3])
results[[3]]
```

```{r GP_check4,fig.height=6,fig.width=9}
print(names(results)[4])
results[[4]]
```

```{r GP_check,fig.height=6,fig.width=9}
print(names(results)[5])
results[[5]]
```

```{r GP_check6,fig.height=6,fig.width=9}
print(names(results)[6])
results[[6]]
```

```{r GP_check7,fig.height=6,fig.width=9}
print(names(results)[7])
results[[7]]
```

```{r GP_check8,fig.height=6,fig.width=9}
print(names(results)[8])
results[[8]]
```

### LW params in GP_tab in table check

The function `MEDBS_LW_check` allows to check the length-weight parameters included in the GP table for a selected species. The function returns a summary table.

```{r MEDBS_LW_check1}
results <- MEDBS_LW_check(GP_tab_example,"MUT","ITA","GSA 18")
results[[1]]
```

plots of the length-weigth relationships for the selected species by year and sex are also returned.

```{r MEDBS_LW_check2,fig.height=6,fig.width=9}
results[[2]]
results[[3]]
results[[4]]
results[[5]]
results[[6]]
results[[7]]
results[[8]]
```

### MA_tab (maturity at age) table check

The function `MEDBS_MA_check` allows to check the maturity at age (MA) table providing a summary table of the data coverage.

```{r MEDBS_MA_check1}
results <- MEDBS_MA_check(MA_tab_example,"DPS","ITA","GSA 99")
results[[1]]
```

The function also provides plots for the selected species of the proportion of matures for age class by sex and year.

```{r MEDBS_MA_check2,fig.height=6,fig.width=9}
results[[2]]
results[[3]]
```

### ML_tab (maturity at length) table check

The function `MEDBS_ML_check` allows to check the maturity at length (ML) table providing a summary table of the data coverage for the selected species of the proportion of matures for age class by sex and year.

```{r MEDBS_ML_check1,fig.height=6,fig.width=9}
results <- MEDBS_ML_check(ML_tab_example, "DPS", "ITA", "GSA 99")
results[[1]]
```

Plots for the selected species of the proportion of matures for age class by sex and year are also returned.

```{r MEDBS_ML_check2,fig.height=6,fig.width=9}
results[[2]]
```

### SA_tab (sex ratio at age) table check

The function `MEDBS_SA_check` allows to check the sex ratio at age (SA) table providing a summary table of the data coverage for the selected species of the proportion of sex ratio for age class by year.

```{r MEDBS_SA_check1}
results <- MEDBS_SA_check(SA_tab_example, "DPS", "ITA", "GSA 99")
results[[1]]
```

Plots for the selected species of the proportion of sex ratio for age class by year are also returned.

```{r MEDBS_SA_check2,fig.height=6,fig.width=9}
results[[2]]
results[[3]]
```

### SL_tab (sex ratio at length) table check

The function `MEDBS_SL_check` allows to check the sex ratio at length (SL) table providing a summary table of the data coverage for the selected species of the proportion of sex ratio for length class by year.

```{r MEDBS_SL_check1}
results <- MEDBS_SL_check(SL_tab_example,"DPS","ITA","GSA 99")
results[[1]]
```

Plots for the selected species of the proportion of sex ratio for length class by year are returned.

```{r MEDBS_SL_check2,fig.height=6,fig.width=9}
results[[2]]
results[[3]]
```

# Checks on FDI tables

## Table G

### Check empty fields in FDI G table

The function `check_EF_FDI_G` checks the presence of not allowed empty data in the given table, according to the 'Fisheries Dependent Information data call 2021 - Annex 1'.
A list is returned by the function. The first list's object is a vector containing the number of NA for each reference column. 

```{r check_EF_FDI_G1}
check_EF_FDI_G(fdi_g_effort, verbose=FALSE)[[1]]
```

The second list's object gives the index of each NA in the reference column.

```{r check_EF_FDI_G2}
check_EF_FDI_G(fdi_g_effort, verbose=FALSE)[[2]]
```

### Check duplicated records in FDI G table

The function `check_RD_FDI_G` check the presence of duplicated records. In particular, it checks whether the combination of the first 15 columns generates duplicate records. The function returns the indices of the duplicated rows.

```{r check_RD_FDI_G}
g_effort <- rbind(fdi_g_effort,fdi_g_effort[1,])
check_RD_FDI_G(g_effort)
```

## Table H

### Check empty fields in FDI H table

The function `check_EF_FDI_H` checks the presence of not allowed empty data in the given table, according to the 'Fisheries Dependent Information data call 2021 - Annex 1'.
A list is returned by the function. The first list's object is a vector containing the number of NA for each reference column. 

```{r check_EF_FDI_H1}
check_EF_FDI_H(fdi_h_spatial_land, verbose=FALSE)[[1]]
```

The second list's object gives the index of each NA in the reference column.

```{r check_EF_FDI_H2}
check_EF_FDI_H(fdi_h_spatial_land, verbose=FALSE)[[2]]
```

### Check duplicated records in FDI H table

The function `check_RD_FDI_H` check the presence of duplicated records. In particular, it checks whether the combination of the first 15 columns generates duplicate records. The function returns the indices of the duplicated rows.

```{r check_RD_FDI_H}
h_spatial_land <- rbind(fdi_h_spatial_land,fdi_h_spatial_land[1,])
check_RD_FDI_H(h_spatial_land)
```

## Table I

### Check empty fields in FDI I table

The function `check_EF_FDI_I` checks the presence of not allowed empty data in the given table, according to the 'Fisheries Dependent Information data call 2021 - Annex 1'. A list is returned by the function. The first list's object is a vector containing the number of NA for each reference column. 

```{r check_EF_FDI_I1}
check_EF_FDI_I(fdi_i_spatial_effort,verbose=FALSE)[[1]]
```

The second list's object gives the index of each NA in the reference column.

```{r check_EF_FDI_I2}
check_EF_FDI_I(fdi_i_spatial_effort,verbose=FALSE)[[2]]
```

### Check duplicated records in FDI I table

The function `check_RD_FDI_I` check the presence of duplicated records. In particular, it checks whether the combination of the first 15 columns generates duplicate records. The function returns the indices of the duplicated rows.

```{r check_RD_FDI_I}
i_spatial_fe <- rbind(fdi_i_spatial_effort,fdi_i_spatial_effort[1,])
check_RD_FDI_I(i_spatial_fe)
```

## Table J

### Check empty fields in FDI J table

The function `check_EF_FDI_J` checks the presence of not allowed empty data in the given table, according to the Fisheries Dependent Information data call 2021 - Annex 1. A list is returned by the function. The first list's object is a vector containing the number of NA for each reference column.

```{r check_EF_FDI_J1}
check_EF_FDI_J(fdi_j_capacity, verbose=FALSE)[[1]]
```

The second list's object gives the index of each NA in the reference column.

```{r check_EF_FDI_J2}
check_EF_FDI_J(fdi_j_capacity, verbose=FALSE)[[2]]
```

### Check duplicated records in FDI J table

The function `check_RD_FDI_J` check the presence of duplicated records. In particular, it checks whether the combination of the first 15 columns generates duplicate records. The function returns the indices of the duplicated rows.

```{r check_RD_FDI_J}
j_capacity <- rbind(fdi_j_capacity,fdi_j_capacity[1,])
check_RD_FDI_J(j_capacity)
```

# GFCM data format

## Task II.2 table

### Check empty fields in GFCM Task II.2 table

The function `check_EF_taskII2` checks the presence of not allowed empty data in the given table, according to the GFCM Data Collection Reference Framework (DCRF, V. 20.1). The function returns two lists. The first list gives the number of NA for each reference column. 

```{r check_EF_taskII2_1}
check_EF_taskII2(task_ii2, verbose=FALSE)[[1]]
```

The second list returns the index of each NA in the reference column.

```{r check_EF_taskII2_2}
check_EF_taskII2(task_ii2, verbose=FALSE)[[2]]
```

### Check of missing combination GSA/Fleet segment per year

Function `check_presence_taskII2` allows to verify the completeness of the GSA/Fleet segments in Task II.2 table, as reported in the combination_taskII2 table. The output is a list of missing combinations GSA/Fleet segment per year.

```{r check_presence_taskII2}
check_presence_taskII2(task_ii2,combination_taskII2,MS="ITA",GSA="18")
```

### Check duplicated records in GFCM Task II.2 table

The function `check_RD_taskII2` checks the presence of duplicated records. In particular, it checks whether the combination of the first 5 columns generates duplicate records. The function returns the indices of the duplicated rows, checking the unique combinations of the first 5 columns of the Task II.2 table.

```{r check_RD_taskII2}
ii2 <- rbind(task_ii2,task_ii2[1,])
check_RD_taskII2(ii2)
```

## Task III table

### Check empty fields in GFCM Task III table

The function `check_EF_taskIII` checks the presence of not allowed empty data in the given table, according to the GFCM Data Collection Reference Framework (DCRF, V. 20.1). The function returns two lists. The first list gives the number of NA for each reference column. 

```{r check_EF_taskIII1}
check_EF_taskIII(task_iii,verbose=FALSE)[[1]]
```

The second list returns the index of each NA in the reference column.

```{r check_EF_taskIII2}
check_EF_taskIII(task_iii,verbose=FALSE)[[2]]
```

### Check duplicated records in GFCM Task III table

The function `check_RD_taskIII` checks the presence of duplicated records. In particular, it checks whether the combination of the first 10 columns generates duplicate records. The function returns the indices of the duplicated rows, checking the unique combinations of the first 10 columns of the Task Task III table.

```{r check_RD_taskIII}
check_RD_taskIII(task_iii)
```

## Task VII.2 table

### Check empty fields in GFCM Task VII.2 table

The function `check_EF_taskVII2` checks the presence of not allowed empty data in the given table, according to the GFCM Data Collection Reference Framework (DCRF, V. 20.1). The function returns two lists. The first list gives the number of NA for each reference column.

```{r check_EF_taskVII2_1}
check_EF_taskVII2(task_vii2, verbose=FALSE)[[1]]
```

The second list returns the index of each NA in the reference column.

```{r check_EF_taskVII2_2}
check_EF_taskVII2(task_vii2, verbose=FALSE)[[2]]
```

### Check duplicated records in GFCM Task VII.2 table

The function `check_RD_taskVII2` checks the presence of duplicated records. In particular, it checks whether the combination of the first 9 columns generates duplicate records. The function returns the indices of the duplicated rows, checking the unique combinations of the first 9 columns of the Task VII.2 table.

```{r check_RD_taskVII2}
check_RD_taskVII2(task_vii2)
```

### Comparison between min/max lengths observed for each species with theoretical values

The function `check_minmaxl_TaskVII.2` allows to verify the consistency of the lengths reported in the TaskVII.2 table with the theoretical values reported in the minmaxLtaskVII2 table. The function allows to identify the records in which the observed lengths are greater or lower than the expected ones.

```{r check_minmaxl_TaskVII.2}
check_minmaxl_TaskVII.2(task_vii2,minmaxLtaskVII2,MS="ITA",GSA="18")
```

### Plot of the relationship length weight for each species

The function `check_lw_TaskVII.2` allows to check the consistency of length-weight relationship in the GFCM Task VII.2 table by species. The function returns a plot of the length weight relationship per species.

```{r check_lw_TaskVII.2,fig.height=6,fig.width=9}
check_lw_TaskVII.2(task_vii2, MS = "ITA", GSA = "18", SP = "BOG")
```



## Task VII.3.1 table

### Check empty fields in GFCM Task VII.3.1 table

The function `check_EF_TaskVII31` checks the presence of not allowed empty data in the given table, according to the GFCM Data Collection Reference Framework (DCRF, V. 20.1). The function returns two lists. The first list gives the number of NA for each reference column.

```{r check_EF_TaskVII31_1}
check_EF_TaskVII31(task_vii31, verbose=FALSE)[[1]]
```

The second list returns the index of each NA in the reference column.

```{r check_EF_TaskVII31_2}
check_EF_TaskVII31(task_vii31, verbose=FALSE)[[2]]
```

### Comparison between min/max L50 observed for each species and sex with theoretical values

The function `check_minmaxl50_TaskVII.3.1` allows to verify the consistency of L50 reported in the TaskVII.3.1 table with the theoretical values reported in the minmaxLtaskVII31 table. The function allows to identify the records in which the observed L50 are greater or lower than the expected ones.
The function returns a table with the comparison between min/max L50 observed for each species and sex with theoretical values. The field check_max of the returned data frame will contain "Warning" in case of L50 outliers.

```{r check_minmaxl50_TaskVII.3.1}
check_minmaxl50_TaskVII.3.1(task_vii31,minmaxLtaskVII31,MS="ITA",GSA="19")
```

### Check duplicated records in GFCM Task VII.3.1 table

The function `check_RD_taskVII31` checks the presence of duplicated records. In particular, it checks whether the combination of the first 5 columns generates duplicate records. The function returns the indices of the duplicated rows, checking the unique combinations of the first 5 columns of the Task VII.3.1 table.

```{r check_RD_taskVII31}
check_RD_taskVII31(task_vii31)
```

## Task VII.3.2 table

### Check empty fields in GFCM Task VII.3.2 table

The function `check_EF_TaskVII31` checks the presence of not allowed empty data in the given table, according to the GFCM Data Collection Reference Framework (DCRF, V. 20.1). The function returns two lists. The first list gives the number of NA for each reference column.

```{r check_EF_TaskVII32_1}
check_EF_TaskVII32(task_vii32, verbose=FALSE)[[1]]
```

The second list returns the index of each NA in the reference column.

```{r check_EF_TaskVII32_2}
check_EF_TaskVII32(task_vii32, verbose=FALSE)[[2]]
```


### Check duplicated records in GFCM Task VII.3.2 table

The function `check_RD_TaskVII32` checks the presence of duplicated records. In particular, it checks whether the combination of the first 10 columns generates duplicate records. The function returns the indices of the duplicated rows, checking the unique combinations of the first 10 columns of the Task VII.3.2 table.

```{r}
check_RD_TaskVII32(task_vii32)
```

### Check mismatching species/Catfau and Sex per maturity stages for Task VII.3.2 table

The function `check_species_catfau_TaskVII.3.2` allows to check the correct codification of faunistic category according to species and sex in Task VII.3.2 table.
Two vectors are returned by the function. The first provides the list of mismatching combination of species/faunistic categories. 

```{r check_species_catfau_TaskVII.3.2_1}
check_species_catfau_TaskVII.3.2(task_vii32,catfau_check,sex_mat, MS="ITA",GSA="18")[[1]]
```

The second vector provides the list of mismatching combination of sex/maturity stages.

```{r check_species_catfau_TaskVII.3.2_2}
check_species_catfau_TaskVII.3.2(task_vii32,catfau_check,sex_mat, MS="ITA",GSA="18")[[2]]
```

### Plot of the maturity stages per length for each sex and species

Function `check_lmat_TaskVII.3.2` plots the lengths at maturity stages by species and sex to easily identify outliers. The function return a plot of the maturity stages per length and sex per species.

```{r check_lmat_TaskVII.3.2,fig.height=6,fig.width=9}
check_lmat_TaskVII.3.2(task_vii32)
```
